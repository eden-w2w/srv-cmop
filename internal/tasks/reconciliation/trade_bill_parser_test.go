package reconciliation

import (
	"fmt"
	"testing"
)

var (
	bills = "交易时间,公众账号ID,商户号,特约商户号,设备号,微信订单号,商户订单号,用户标识,交易类型,交易状态,付款银行,货币种类,应结订单金额,代金券金额,微信退款单号,商户退款单号,退款金额,充值券退款金额,退款类型,退款状态,商品名称,商户数据包,手续费,费率,订单金额,申请退款金额,费率备注\n`2021-11-03 16:27:46,`wx781f81919d316e64,`1615730640,`0,`,`4200001305202111038014663535,`1457840828847316992,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`SUCCESS,`OTHERS,`CNY,`2.00,`0.00,`0,`0,`0.00,`0.00,`,`,`比翼婚宴酒,`,`0.01000,`0.54%,`2.00,`0.00,`\n`2021-11-04 16:43:40,`wx781f81919d316e64,`1615730640,`0,`,`4200001166202111047227264810,`1458207191432445952,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`SUCCESS,`OTHERS,`CNY,`0.10,`0.00,`0,`0,`0.00,`0.00,`,`,`比翼婚宴酒,`,`0.00000,`0.54%,`0.10,`0.00,`\n`2021-11-04 16:46:14,`wx781f81919d316e64,`1615730640,`0,`,`4200001166202111047227264810,`1458207191432445952,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`REFUND,`OTHERS,`CNY,`0.00,`0.00,`50301310092021110414061713717,`1361673282021110472272648101636015530,`0.10,`0.00,`ORIGINAL,`SUCCESS,`比翼婚宴酒,`,`0.00000,`0.54%,`0.00,`0.10,`\n`2021-11-04 09:52:59,`wx781f81919d316e64,`1615730640,`0,`,`4200001305202111038014663535,`1457840828847316992,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`REFUND,`OTHERS,`CNY,`0.00,`0.00,`50301410092021110414053326624,`1361673282021110380146635351635990720,`2.00,`0.00,`ORIGINAL,`SUCCESS,`比翼婚宴酒,`,`-0.01000,`0.54%,`0.00,`2.00,`\n`2021-11-08 10:51:13,`wx781f81919d316e64,`1615730640,`0,`,`4200001164202111088852997943,`1459568016407699456,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`SUCCESS,`OTHERS,`CNY,`0.10,`0.00,`0,`0,`0.00,`0.00,`,`,`比翼婚宴酒,`,`0.00000,`0.54%,`0.10,`0.00,`\n`2021-11-08 11:12:45,`wx781f81919d316e64,`1615730640,`0,`,`4200001191202111089793755564,`1459573487357161472,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`SUCCESS,`OTHERS,`CNY,`0.10,`0.00,`0,`0,`0.00,`0.00,`,`,`比翼婚宴酒,`,`0.00000,`0.54%,`0.10,`0.00,`\n`2021-11-08 11:02:27,`wx781f81919d316e64,`1615730640,`0,`,`4200001190202111085748232386,`1459570875660517376,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`SUCCESS,`OTHERS,`CNY,`0.10,`0.00,`0,`0,`0.00,`0.00,`,`,`比翼婚宴酒,`,`0.00000,`0.54%,`0.10,`0.00,`\n`2021-11-08 17:58:40,`wx781f81919d316e64,`1615730640,`0,`,`4200001196202111080197955266,`1459675636938350592,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`SUCCESS,`OTHERS,`CNY,`0.20,`0.00,`0,`0,`0.00,`0.00,`,`,`比翼婚宴酒,`,`0.00000,`0.54%,`0.20,`0.00,`\n`2021-11-08 10:53:56,`wx781f81919d316e64,`1615730640,`0,`,`4200001164202111088852997943,`1459568016407699456,`omDMn5V4hdJjhxzJ0NOUapsxSw-8,`JSAPI,`REFUND,`OTHERS,`CNY,`0.00,`0.00,`50301510102021110814185025701,`1361673282021110888529979431636339995,`0.10,`0.00,`ORIGINAL,`SUCCESS,`比翼婚宴酒,`,`0.00000,`0.54%,`0.00,`0.10,`\n总交易单数,应结订单总金额,退款总金额,充值券退款总金额,手续费总金额,订单总金额,申请退款总金额\n`9.0,`2.6,`2.2,`0.0,`0.0,`2.6,`2.2"
)

func TestIterator(t *testing.T) {
	parser := NewTradeBillParser([]byte(bills))
	err := parser.Iterator(
		func(bill *TradeBill, last bool) (err error, ignore bool) {
			fmt.Printf("%+v\n", bill)
			return nil, true
		},
	)
	if err != nil {
		t.Error(err)
	}
}
